var recordType = fd_data.subflow_inputs.record_type; // 'credit', 'non-credit', or 'both'
var requestType = fd_data.subflow_inputs.signature_parent_record.request_type;
var creditRec = fd_data.subflow_inputs.credit_record;
var nonCreditRec = fd_data.subflow_inputs.non_credit_record;
    
var needsCreditTask = false;
var needsNonCreditTask = false;
    
    // Credit always needs a task if present
if ((recordType == 'credit' || recordType == 'both') && creditRec && !creditRec.nil()) {
    needsCreditTask = true;
}
    
// Non-credit only needs task based on wire transfer logic
if ((recordType == 'non-credit' || recordType == 'both') && nonCreditRec && !nonCreditRec.nil()) {
    var wireExternal = parseFloat(nonCreditRec.disbursement_wire_transfer_external.getValue()) || 0;
    var wireInternal = parseFloat(nonCreditRec.disbursement_wire_transfer_internal.getValue()) || 0;
    var origWireExternal = parseFloat(nonCreditRec.original_disbursement_wire_transfer_external.getValue()) || 0;
    var origWireInternal = parseFloat(nonCreditRec.original_disbursement_wire_transfer_internal.getValue()) || 0;
        
    if (requestType == 'new_authority') {
        // NEW: Need task if either value is positive
        needsNonCreditTask = (wireExternal > 0 || wireInternal > 0);
    }
    else if (requestType == 'change_to_existing_authority') {
        // CHANGE: Need task if either value changed from original
        needsNonCreditTask = (wireExternal != origWireExternal || wireInternal != origWireInternal);
        }
    else if (requestType == 'remove_authority') {
        // REMOVE: Need task if either original value was positive
            needsNonCreditTask = (origWireExternal > 0 || origWireInternal > 0);
    }
}
    
// Determine final record_type or exit early
if (!needsCreditTask && !needsNonCreditTask) {
    return 'none'; // No task needed at all
}
if (needsCreditTask && needsNonCreditTask) {
    return 'both';
}
if (needsCreditTask) {
    return 'credit';
}
return 'non-credit';

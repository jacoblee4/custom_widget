<!-- ============================================ -->
<!-- HTML TEMPLATE - EMPLOYEE LOOKUP BY JOB CODE -->
<!-- ============================================ -->

<div class="employee-lookup-widget">
  <div class="widget-header">
    <h2>
      <i class="fa fa-users"></i>
      <span ng-if="!c.jobCode">Employees by Job Code</span>
      <span ng-if="c.jobCode">Employees with Job Code: <strong>{{c.jobCodeDisplay}}</strong></span>
    </h2>
  </div>
  
  <!-- No Job Code Selected Message -->
  <div ng-if="!c.jobCode" class="info-message">
    <i class="fa fa-info-circle info-icon"></i>
    <div class="info-content">
      <h3>Select a Job Code to View Employees</h3>
      <p>Select any of the job codes in the Authority Limits table above to view all employees with that job code.</p>
    </div>
  </div>
  
  <!-- Loading Indicator -->
  <div ng-if="c.jobCode && c.loading" class="text-center loading-container">
    <i class="fa fa-spinner fa-spin fa-2x"></i>
    <p>Loading employees for job code {{c.jobCodeDisplay}}...</p>
  </div>
  
  <!-- No Employees Found -->
  <div ng-if="c.jobCode && !c.loading && c.employees.length === 0" class="alert alert-warning">
    <i class="fa fa-exclamation-triangle"></i>
    No active employees found for job code <strong>{{c.jobCodeDisplay}}</strong>
  </div>
  
  <!-- Employees Table -->
  <div ng-if="c.jobCode && !c.loading && c.employees.length > 0" class="employees-container">
    <div class="employees-count-badge">
      {{c.employees.length}} {{c.employees.length === 1 ? 'Employee' : 'Employees'}}
    </div>
    
    <div class="table-responsive">
      <table class="employees-table">
        <thead>
          <tr>
            <th class="sortable" ng-click="c.sortBy('name')">
              Name
              <span class="sort-arrows">
                <i class="fa fa-sort-asc" ng-class="{'active-sort': c.sortColumn === 'name' && c.sortDirection === 'asc'}"></i>
                <i class="fa fa-sort-desc" ng-class="{'active-sort': c.sortColumn === 'name' && c.sortDirection === 'desc'}"></i>
              </span>
            </th>
            <th class="sortable" ng-click="c.sortBy('title')">
              Title
              <span class="sort-arrows">
                <i class="fa fa-sort-asc" ng-class="{'active-sort': c.sortColumn === 'title' && c.sortDirection === 'asc'}"></i>
                <i class="fa fa-sort-desc" ng-class="{'active-sort': c.sortColumn === 'title' && c.sortDirection === 'desc'}"></i>
              </span>
            </th>
            <th class="sortable" ng-click="c.sortBy('u_officer_title')">
              Officer Title
              <span class="sort-arrows">
                <i class="fa fa-sort-asc" ng-class="{'active-sort': c.sortColumn === 'u_officer_title' && c.sortDirection === 'asc'}"></i>
                <i class="fa fa-sort-desc" ng-class="{'active-sort': c.sortColumn === 'u_officer_title' && c.sortDirection === 'desc'}"></i>
              </span>
            </th>
            <th class="sortable" ng-click="c.sortBy('department_display')">
              Department
              <span class="sort-arrows">
                <i class="fa fa-sort-asc" ng-class="{'active-sort': c.sortColumn === 'department_display' && c.sortDirection === 'asc'}"></i>
                <i class="fa fa-sort-desc" ng-class="{'active-sort': c.sortColumn === 'department_display' && c.sortDirection === 'desc'}"></i>
              </span>
            </th>
            <th class="sortable" ng-click="c.sortBy('manager_display')">
              Manager
              <span class="sort-arrows">
                <i class="fa fa-sort-asc" ng-class="{'active-sort': c.sortColumn === 'manager_display' && c.sortDirection === 'asc'}"></i>
                <i class="fa fa-sort-desc" ng-class="{'active-sort': c.sortColumn === 'manager_display' && c.sortDirection === 'desc'}"></i>
              </span>
            </th>
            <th>Email</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="employee in c.getCurrentPageEmployees()">
            <td class="name-cell">
              <strong>{{employee.name}}</strong>
            </td>
            <td class="text-cell">{{employee.title || '-'}}</td>
            <td class="text-cell">{{employee.u_officer_title || '-'}}</td>
            <td class="text-cell">{{employee.department_display || '-'}}</td>
            <td class="text-cell">{{employee.manager_display || '-'}}</td>
            <td class="email-cell">
              <a ng-if="employee.email" href="mailto:{{employee.email}}" class="email-link">
                <i class="fa fa-envelope"></i> {{employee.email}}
              </a>
              <span ng-if="!employee.email">-</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <div ng-if="c.totalPages > 1" class="pagination-controls">
      <nav aria-label="Employee pagination">
        <ul class="pagination">
          <li class="page-item" ng-class="{disabled: c.currentPage === 1}">
            <a class="page-link" href="javascript:void(0)" ng-click="c.previousPage()" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
          <li class="page-item" ng-repeat="page in c.getPageNumbers()" 
              ng-class="{active: page === c.currentPage}">
            <a class="page-link" href="javascript:void(0)" ng-click="c.goToPage(page)">{{page}}</a>
          </li>
          <li class="page-item" ng-class="{disabled: c.currentPage === c.totalPages}">
            <a class="page-link" href="javascript:void(0)" ng-click="c.nextPage()" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>
      <div class="pagination-info">
        Showing {{c.getStartIndex() + 1}}-{{c.getEndIndex()}} of {{c.employees.length}} employees
      </div>
    </div>
  </div>
</div>




<!-- ============================================ -->
<!-- CSS -->
<!-- ============================================ -->

.employee-lookup-widget {
  padding: 20px;
  font-family: 'Source Sans Pro', Arial, sans-serif;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  margin-top: 24px;
}

.widget-header {
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 2px solid #e8e8e8;
}

.widget-header h2 {
  color: #333;
  font-size: 20px;
  font-weight: 600;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Info Message Styles */
.info-message {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 30px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 8px;
  color: white;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.info-icon {
  font-size: 48px;
  opacity: 0.9;
  flex-shrink: 0;
}

.info-content h3 {
  margin: 0 0 8px 0;
  font-size: 20px;
  font-weight: 600;
  color: white;
}

.info-content p {
  margin: 0;
  font-size: 15px;
  line-height: 1.5;
  opacity: 0.95;
}

/* Loading Container */
.loading-container {
  text-align: center;
  padding: 40px;
}

.loading-container .fa-spinner {
  color: #3498db;
  margin-bottom: 12px;
}

.loading-container p {
  color: #6c757d;
  font-size: 14px;
  margin-top: 12px;
}

/* Alert Styles */
.alert {
  padding: 12px 15px;
  border-radius: 4px;
  margin-bottom: 15px;
  border: 1px solid transparent;
  display: flex;
  align-items: center;
  gap: 10px;
}

.alert-warning {
  background-color: #fff3cd;
  border-color: #ffeeba;
  color: #856404;
}

.alert i {
  font-size: 18px;
}

/* Employees Container */
.employees-container {
  margin-top: 0;
}

.employees-count-badge {
  display: inline-block;
  background: #3498db;
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 20px;
}

.text-cell {
  color: #6c757d;
}

.email-cell {
  /* Regular font, not monospace */
}

/* Table Styles */
.table-responsive {
  overflow-x: auto;
  border: 1px solid #dee2e6;
  border-radius: 6px;
  background: white;
}

.employees-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.employees-table thead {
  background: #f8f9fa;
  border-bottom: 2px solid #dee2e6;
}

.employees-table th {
  padding: 12px;
  text-align: left;
  font-weight: 600;
  color: #495057;
  white-space: nowrap;
  border-right: 1px solid #e9ecef;
  position: relative;
}

.employees-table th:last-child {
  border-right: none;
}

.employees-table th.sortable {
  cursor: pointer;
  user-select: none;
  padding-right: 28px;
  transition: background-color 0.2s;
}

.employees-table th.sortable:hover {
  background: #e9ecef;
}

.sort-arrows {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 0;
  line-height: 0.6;
}

.sort-arrows i {
  font-size: 10px;
  color: #cbd5e0;
  transition: color 0.2s;
}

.sort-arrows i.active-sort {
  color: #3498db;
  font-weight: bold;
}

.employees-table tbody td {
  padding: 12px;
  border-bottom: 1px solid #e9ecef;
  vertical-align: middle;
  border-right: 1px solid #f1f3f5;
}

.employees-table tbody td:last-child {
  border-right: none;
}

.employees-table tbody tr:last-child td {
  border-bottom: none;
}

.employees-table tbody tr:hover {
  background-color: #f8f9fa;
}

.name-cell {
  color: #2c3e50;
  font-weight: 600;
}

.text-cell {
  color: #6c757d;
}

.email-link {
  color: #3498db;
  text-decoration: none;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.email-link:hover {
  color: #2980b9;
  text-decoration: underline;
}

.email-link i {
  font-size: 14px;
}

/* Pagination Styles */
.pagination-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 15px;
  padding-top: 16px;
  margin-top: 20px;
  border-top: 1px solid #e9ecef;
}

.pagination {
  display: flex;
  list-style: none;
  padding: 0;
  margin: 0;
  gap: 5px;
}

.page-item {
  display: inline-block;
}

.page-link {
  display: block;
  padding: 6px 12px;
  color: #3498db;
  text-decoration: none;
  background-color: white;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  transition: all 0.3s;
}

.page-link:hover {
  background-color: #e9ecef;
  border-color: #adb5bd;
}

.page-item.active .page-link {
  background-color: #3498db;
  border-color: #3498db;
  color: white;
}

.page-item.disabled .page-link {
  color: #6c757d;
  pointer-events: none;
  cursor: not-allowed;
  background-color: #fff;
  border-color: #dee2e6;
  opacity: 0.5;
}

.pagination-info {
  color: #6c757d;
  font-size: 14px;
}

/* Responsive Design */
@media (max-width: 768px) {
  .employees-table {
    font-size: 13px;
  }
  
  .employees-table th,
  .employees-table td {
    padding: 8px;
  }
}

.fa {
  margin-right: 0;
}




<!-- ============================================ -->
<!-- SERVER SCRIPT -->
<!-- ============================================ -->

(function() {
  'use strict';

  if (input && input.action === 'getEmployeesByJobCode') {
    var jobCode = input.job_code;
    var employees = [];
    
    if (jobCode) {
      // Query the sys_user table for active users with this job code
      var userGr = new GlideRecord('sys_user');
      userGr.addQuery('u_job_code', jobCode);
      userGr.addQuery('active', true);
      userGr.orderBy('name');
      userGr.query();
      
      while (userGr.next()) {
        var employee = {
          sys_id: userGr.getValue('sys_id'),
          name: userGr.getValue('name') || '',
          title: userGr.getValue('title') || '',
          u_officer_title: userGr.getValue('u_officer_title') || '',
          department: userGr.getValue('department'),
          department_display: userGr.department.getDisplayValue() || '',
          manager: userGr.getValue('manager'),
          manager_display: userGr.manager.getDisplayValue() || '',
          email: userGr.getValue('email') || ''
        };
        
        employees.push(employee);
      }
    }
    
    data.employees = employees;
    data.jobCode = jobCode;
  }
})();




<!-- ============================================ -->
<!-- CLIENT CONTROLLER -->
<!-- ============================================ -->

api.controller = function($scope, $rootScope, $timeout, spUtil) {
  var c = this;
  
  // Initialize variables
  c.jobCode = '';
  c.jobCodeDisplay = '';
  c.jobCodeSysId = '';
  c.employees = [];
  c.loading = false;
  
  // Sorting
  c.sortColumn = 'name';
  c.sortDirection = 'asc';
  
  // Pagination - 25 items per page
  c.currentPage = 1;
  c.pageSize = 25;
  c.totalPages = 1;
  
  c.$onInit = function() {
    console.log('Employee Lookup Widget initialized');
    
    // Listen for job code selection from Signature Authority Limits widget
    $scope.$on('jobCodeSelected', function(event, data) {
      console.log('Received jobCodeSelected event:', data);
      
      c.jobCode = data.jobCode;
      c.jobCodeDisplay = data.jobCodeDisplay;
      c.jobCodeSysId = data.jobCodeSysId;
      
      // Load employees for this job code
      c.loadEmployees();
    });
  };
  
  // Load employees by job code
  c.loadEmployees = function() {
    console.log('Loading employees for job code:', c.jobCode);
    
    if (!c.jobCode) {
      c.employees = [];
      return;
    }
    
    c.loading = true;
    
    c.server.get({
      action: 'getEmployeesByJobCode',
      job_code: c.jobCode
    }).then(function(response) {
      console.log('Server response:', response);
      c.employees = response.data.employees || [];
      
      // Apply default sorting
      c.sortEmployees();
      
      // Calculate pagination
      c.currentPage = 1;
      c.totalPages = parseInt((c.employees.length + c.pageSize - 1) / c.pageSize);
      
      c.loading = false;
    }).catch(function(error) {
      console.error('Error loading employees:', error);
      spUtil.addErrorMessage('Failed to load employees');
      c.employees = [];
      c.loading = false;
    });
  };
  
  // Sorting function
  c.sortBy = function(column) {
    if (c.sortColumn === column) {
      // Toggle direction if clicking same column
      c.sortDirection = c.sortDirection === 'asc' ? 'desc' : 'asc';
    } else {
      // New column - default to ascending
      c.sortColumn = column;
      c.sortDirection = 'asc';
    }
    
    c.sortEmployees();
  };
  
  // Sort employees array
  c.sortEmployees = function() {
    c.employees.sort(function(a, b) {
      var aVal = a[c.sortColumn] || '';
      var bVal = b[c.sortColumn] || '';
      
      // Convert to lowercase for case-insensitive sorting
      aVal = aVal.toString().toLowerCase();
      bVal = bVal.toString().toLowerCase();
      
      if (aVal < bVal) {
        return c.sortDirection === 'asc' ? -1 : 1;
      }
      if (aVal > bVal) {
        return c.sortDirection === 'asc' ? 1 : -1;
      }
      return 0;
    });
// Pagination functions
  c.getCurrentPageEmployees = function() {
    var start = (c.currentPage - 1) * c.pageSize;
    var end = start + c.pageSize;
    return c.employees.slice(start, end);
  };

  c.getStartIndex = function() {
    return (c.currentPage - 1) * c.pageSize;
  };

  c.getEndIndex = function() {
    var end = c.currentPage * c.pageSize;
    return end > c.employees.length ? c.employees.length : end;
  };

  c.previousPage = function() {
    if (c.currentPage > 1) {
      c.currentPage--;
    }
  };

  c.nextPage = function() {
    if (c.currentPage < c.totalPages) {
      c.currentPage++;
    }
  };

  c.goToPage = function(page) {
    if (page >= 1 && page <= c.totalPages) {
      c.currentPage = page;
    }
  };

  c.getPageNumbers = function() {
    var pages = [];
    var maxPagesToShow = 5;
    var startPage = 1;
    var endPage = c.totalPages;
    
    if (c.totalPages > maxPagesToShow) {
      var middlePage = parseInt(maxPagesToShow / 2);
      if (c.currentPage <= middlePage) {
        endPage = maxPagesToShow;
      } else if (c.currentPage >= c.totalPages - middlePage) {
        startPage = c.totalPages - maxPagesToShow + 1;
      } else {
        startPage = c.currentPage - middlePage;
        endPage = c.currentPage + middlePage;
      }
    }
    
    for (var i = startPage; i <= endPage; i++) {
      pages.push(i);
    }
    
    return pages;
  };
};
  };
};

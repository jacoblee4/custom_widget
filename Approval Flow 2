// Find next approver in hierarchy with sufficient authority
    findHierarchicalApprover: function(startingApproverSysId, divisionHeadSysId, amount, type) {
        var result = {
            found_approver: false,
            approver_sys_id: '',
            is_division_head: false,
            reached_division_head: false,
            reached_ceo: false,
            message: ''
        };

        var currentApprover = startingApproverSysId;
        var maxLevels = 20;
        var currentLevel = 0;

        while (currentApprover && currentLevel < maxLevels) {
            // Check if approver exists and is active
            var userGr = new GlideRecord('sys_user');
            if (!userGr.get(currentApprover)) {
                result.message = 'User not found in hierarchy';
                break;
            }

            if (!userGr.active) {
                result.message = 'Inactive user found in hierarchy: ' + userGr.getValue('name');
                break;
            }

            // Check if this is the CEO
            if (this._isCEO_check(currentApprover)) {
                result.reached_ceo = true;
                result.message = 'CEO found in hierarchy - escalating to committee';
                return result;
            }

            // Check if this person has authority
            var authCheck = this.checkDelegatedAuthority(currentApprover, amount, type);

            if (authCheck.has_authority) {
                result.found_approver = true;
                result.approver_sys_id = currentApprover;
                result.message = authCheck.message;
                return result;
            }

            if (currentApprover === divisionHeadSysId) {
                result.reached_division_head = true;
                result.is_division_head = true;
                result.message = 'Reached division head without finding approver with authority';
                return result;
            }

            // Move to next manager
            var nextManager = userGr.getValue('manager');

            if (!nextManager) {
                result.message = 'End of hierarchy - no manager found';
                break;
            }

            currentApprover = nextManager;
            currentLevel++;
        }

        if (currentLevel >= maxLevels) {
            result.message = 'Maximum hierarchy levels reached';
        } else if (!result.message) {
            result.message = 'No approver found in hierarchy';
        }

        return result;
    },

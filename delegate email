(function runMailScript(current, template, email, email_action, event) {

    // This script is designed for sysapproval_approver table notifications
    if (current.getTableName() != 'sysapproval_approver') {
        gs.error('Delegate Email Script Error: This script must be run on sysapproval_approver table');
        return;
    }

    var content = '';

    content += '<div style="font-family: Arial, sans-serif; color: #000000; max-width: 800px;">';

    // Get approval information
    var approverSysId = current.getValue('approver');
    var updatedByUsername = current.getValue('sys_updated_by');
    
    var requestedApproverName = current.approver.getDisplayValue();
    var actualApproverName = '';
    
    // Look up the actual approver who clicked approve/reject using sys_updated_by
    if (updatedByUsername) {
        var userGR = new GlideRecord('sys_user');
        userGR.addQuery('user_name', updatedByUsername);
        userGR.query();
        
        if (userGR.next()) {
            actualApproverName = userGR.getValue('name');
        }
    }
    
    // If we couldn't find the actual approver, use a fallback
    if (!actualApproverName) {
        actualApproverName = 'Unknown';
    }

    content += '<div style="background-color: #fff3cd; padding: 15px; margin: 20px 0; border-left: 4px solid #ffc107; border-radius: 4px;">';
    content += '<h3 style="color: #856404; margin: 0 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #ffc107;">Delegated Approver Details</h3>';
    content += '<table style="width: 100%; border-collapse: collapse;">';
    content += '<tr><td style="padding: 8px; font-weight: bold; width: 200px; color: #856404;">Requested Approver:</td><td style="padding: 8px; color: #856404;">' + requestedApproverName + '</td></tr>';
    content += '<tr><td style="padding: 8px; font-weight: bold; color: #856404;">Actioned By (Delegate):</td><td style="padding: 8px; color: #856404;">' + actualApproverName + '</td></tr>';
    content += '</table>';
    content += '</div>';

    content += '</div>';

    template.print(content);

})(current, template, email, email_action, event);
